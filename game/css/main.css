
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap');

        * {
            box-sizing: border-box;
        }

        :root {
            --color-bg: #050505;
            --color-border: #3d3d3d;
            --color-accent: #c21e1e;
            --color-gold: #cfaa6e;
            --color-text: #a8a8a8;
        }

        body {
            background-color: var(--color-bg);
            background-image: url('../img/locations/tło na podróż.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: var(--color-text);
            font-family: 'Cinzel', serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            /* No scrolling in game mode */
            user-select: none;
            /* iOS safe areas */
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        /* Rotate phone overlay */
        .rotate-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--color-gold);
            text-align: center;
            padding: 20px;
        }

        .rotate-overlay .rotate-icon {
            font-size: 80px;
            animation: rotatePhone 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .rotate-overlay h2 {
            font-size: 1.5rem;
            margin: 0 0 10px 0;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .rotate-overlay p {
            font-size: 1rem;
            color: #888;
            margin: 0;
        }

        @keyframes rotatePhone {

            0%,
            100% {
                transform: rotate(-30deg);
            }

            50% {
                transform: rotate(30deg);
            }
        }

        .rotate-fullscreen-btn {
            margin-top: 30px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 180, 0, 0.1));
            border: 2px solid var(--color-gold);
            color: var(--color-gold);
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .rotate-fullscreen-btn:hover,
        .rotate-fullscreen-btn:active {
            background: var(--color-gold);
            color: #000;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }

        .rotate-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        @media screen and (max-width: 900px) and (orientation: portrait) {
            .rotate-overlay {
                display: flex;
            }

            #selectScreen,
            #gameScreen {
                display: none !important;
            }
        }

        /* --- CHARACTER SELECT SCREEN --- */
        #selectScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
            transition: opacity 0.5s;
        }

        #selectScreen.hidden {
            opacity: 0;
            pointer-events: none;
            display: none;
        }

        h1 {
            font-size: 2.5rem;
            color: var(--color-accent);
            text-shadow: 0 0 20px rgba(194, 30, 30, 0.5), 0 5px 10px black;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 5px;
            border-bottom: 2px solid var(--color-border);
            display: inline-block;
            padding-bottom: 10px;
        }

        h2 {
            font-size: 1rem;
            color: var(--color-gold);
            margin-bottom: 30px;
            font-weight: 400;
        }

        .grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            perspective: 1000px;
            max-width: 1000px;
            margin: 0 auto;
            padding-bottom: 100px;
        }

        .card {
            background: linear-gradient(180deg, #1a2a3a 0%, #0d1821 50%, #0a1520 100%);
            border: 1px solid rgba(100, 180, 255, 0.3);
            width: 180px;
            height: 280px;
            position: relative;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(50, 150, 255, 0.2), inset 0 0 30px rgba(100, 180, 255, 0.05);
            border-radius: 8px;
        }

        .card:hover {
            transform: translateY(-5px) scale(1.05);
            border-color: rgba(100, 200, 255, 0.6);
            box-shadow: 0 10px 30px rgba(50, 150, 255, 0.4), inset 0 0 40px rgba(100, 180, 255, 0.1);
            z-index: 10;
        }

        .card.selected {
            border-color: #00d4ff;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.6), inset 0 0 20px rgba(0, 212, 255, 0.1);
            transform: scale(1.05);
            z-index: 20;
        }

        .card:hover {
            transform: translateY(-5px) scale(1.05);
            border-color: var(--color-gold);
            z-index: 10;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .card.selected {
            border-color: var(--color-accent);
            box-shadow: 0 0 20px rgba(194, 30, 30, 0.6);
            transform: scale(1.05);
            z-index: 20;
        }

        .card-image-container {
            width: 100%;
            height: 70%;
            overflow: hidden;
            border-bottom: 1px solid var(--color-border);
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top center;
            transition: transform 0.5s ease;
            filter: grayscale(40%) contrast(1.2);
        }

        .card:hover .card-image {
            transform: scale(1.1);
            filter: grayscale(0%) contrast(1.1);
        }

        .card-content {
            padding: 10px;
            height: auto;
            min-height: 60px;
            background: linear-gradient(180deg, #1a1a1a, #111);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            gap: 4px;
        }

        .class-name {
            font-size: 0.9rem;
            color: var(--color-gold);
            text-transform: uppercase;
            font-weight: bold;
            white-space: normal;
            word-wrap: break-word;
            line-height: 1.2;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .char-attribute {
            font-size: 0.75rem;
            color: #888;
            font-style: italic;
        }

        .card:hover .select-btn {
            background: var(--color-gold);
            color: black;
            font-weight: bold;
        }

        .card.selected .select-btn {
            background: var(--color-accent);
            color: white;
            border-color: red;
        }

        .orb {
            position: fixed;
            bottom: 20px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 30% 30%, #ff4d4d, #800000, #330000);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--color-accent), inset 0 0 15px black;
            border: 3px solid #333;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            text-shadow: 0 0 5px black;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .orb:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        .orb-right {
            right: 20px;
            background: linear-gradient(135deg, #22c55e, #16a34a, #15803d);
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.6), inset 0 -5px 15px rgba(0, 0, 0, 0.4);
            visibility: hidden;
            opacity: 0;
            transition: all 0.5s;
            font-weight: bold;
            letter-spacing: 3px;
            font-size: 1.1rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .orb-right:hover {
            transform: scale(1.15);
            box-shadow: 0 0 40px rgba(34, 197, 94, 0.8), inset 0 -5px 20px rgba(0, 0, 0, 0.5);
        }

        .orb-right.visible {
            visibility: visible;
            opacity: 1;
            animation: pulseGreen 2s ease-in-out infinite;
        }

        @keyframes pulseGreen {

            0%,
            100% {
                box-shadow: 0 0 25px rgba(34, 197, 94, 0.6), inset 0 -5px 15px rgba(0, 0, 0, 0.4);
            }

            50% {
                box-shadow: 0 0 40px rgba(34, 197, 94, 0.9), inset 0 -5px 15px rgba(0, 0, 0, 0.4);
            }
        }

        /* --- GAME SCREEN (Margonem Style) --- */
        #gameScreen {
            display: none;
            width: 100vw;
            height: 100vh;
            position: relative;
            background: #000;
        }

        #gameScreen.active {
            display: block;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            grid-template-rows: 60px 1fr;
            height: 100%;
            width: 100%;
        }

        @media (max-width: 1024px) {
            .game-layout {
                grid-template-columns: 0 1fr 0;
                /* Hide panels on mobile/tablet */
            }

            .panel {
                display: none;
                /* Hide panel content */
            }

            /* Enable map full width */
            .game-map-container {
                grid-column: 1 / -1;
            }
        }

        /* Top Bar */
        .top-bar {
            grid-column: 1 / -1;
            background: #111;
            border-bottom: 2px solid var(--color-border);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 20px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 33%;
        }

        .player-avatar-mini {
            width: 40px;
            height: 40px;
            border: 2px solid var(--color-gold);
            border-radius: 50%;
            object-fit: cover;
        }

        .player-bars {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .bar {
            height: 8px;
            background: #333;
            border: 1px solid #555;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            width: 100%;
            transition: width 0.3s;
        }

        .hp {
            background: #b30000;
        }

        .mana {
            background: #0044cc;
        }

        .exp {
            background: #d4af37;
            height: 4px;
            margin-top: 2px;
        }

        /* === MODERN HUD STYLES === */
        .hud-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hud-bars {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 100px;
        }

        .hud-bar {
            height: 14px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            box-shadow:
                inset 0 2px 4px rgba(0, 0, 0, 0.5),
                0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .hud-bar-fill {
            height: 100%;
            border-radius: 8px;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .hud-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 8px 8px 0 0;
        }

        .hud-bar.hp .hud-bar-fill {
            background: linear-gradient(90deg, #dc2626 0%, #ef4444 50%, #f87171 100%);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .hud-bar.mana .hud-bar-fill {
            background: linear-gradient(90deg, #2563eb 0%, #3b82f6 50%, #60a5fa 100%);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .hud-bar-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 9px;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.9);
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .hud-center {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .hud-center #hudName {
            font-size: 11px;
            color: #fbbf24;
            font-weight: bold;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
        }

        .hud-level {
            font-size: 10px;
            color: #a78bfa;
            font-weight: 600;
            background: rgba(167, 139, 250, 0.15);
            padding: 2px 6px;
            border-radius: 10px;
        }

        .hud-center #hudXP {
            font-size: 9px;
            color: #888;
        }

        .hud-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .hud-gold {
            font-size: 14px;
            color: #fcd34d;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(252, 211, 77, 0.4);
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(252, 211, 77, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            border: 1px solid rgba(252, 211, 77, 0.2);
        }

        .hud-menu-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(5px);
        }

        .hud-menu-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .player-avatar-mini {
            width: 38px;
            height: 38px;
            border: 2px solid #fbbf24;
            border-radius: 50%;
            object-fit: cover;
            box-shadow:
                0 0 15px rgba(251, 191, 36, 0.3),
                inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .top-bar {
            grid-column: 1 / -1;
            background: linear-gradient(180deg, rgba(15, 15, 20, 0.95) 0%, rgba(10, 10, 15, 0.9) 100%);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 15px;
            height: 55px;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Mobile specific HUD overrides */
        @media (max-width: 1024px) {
            .hud-right .hud-menu-btn {
                display: none;
                /* Hide old menu btn */
            }
        }

        .mobile-hud-btns {
            display: none;
        }

        @media (max-width: 1024px) {
            .mobile-hud-btns {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .mobile-icon-btn {
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                font-size: 20px;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                filter: none;
                transition: all 0.2s ease;
            }

            .mobile-icon-btn:active {
                background: rgba(255, 255, 255, 0.15);
                transform: scale(0.95);
            }
        }

        /* MOBILE MODAL STYLES - Enlarged for EQ */
        .mobile-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 95%;
            /* Increased from 90% */
            max-width: 700px;
            /* Increased from 400px */
            height: 90vh;
            /* Increased height */
            background: rgba(10, 10, 15, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 2000;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            color: #eee;
            border-radius: 20px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.9);
        }

        .mobile-modal.active {
            display: flex;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
            /* Compact */
            margin-bottom: 10px;
            flex-shrink: 0;
            /* Keep header visible */
        }

        .modal-body {
            overflow-y: auto;
            /* Enable scrolling */
            flex-grow: 1;
            padding-right: 5px;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--color-gold);
            font-size: 1.2rem;
            /* Smaller font */
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            padding: 5px 12px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .modal-close:active {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(0.9);
        }

        .mobile-stats {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 2px;
            font-size: 0.85rem;
            /* Small font */
            margin-bottom: 5px;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Increased specificity */
        .mobile-modal .mobile-grid {
            display: grid;
            /* SLIGHTLY BIGGER tiles per user request */
            grid-template-columns: repeat(auto-fill, 44px);
            gap: 4px;
            padding-bottom: 10px;
            justify-content: start;
            /* Pack to left */
        }

        .mobile-grid .eq-slot {
            width: 44px;
            /* Bigger tiles */
            height: 44px;
            /* Fixed height */
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mobile-grid .eq-slot img {
            width: 75%;
            /* Visually smaller inside the box */
            height: 75%;
            object-fit: contain;
        }

        .quest-list {
            list-style: none;
            padding: 0;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        /* LANDSCAPE OPTIMIZATION */
        @media (max-width: 1024px) and (orientation: landscape) {
            .mobile-modal {
                flex-direction: row;
                padding: 4px;
                gap: 10px;
                /* More gap between sidebar and grid */
            }

            .modal-header {
                display: none;
                /* Hide standard header in landscape to save space */
            }

            /* Create a sidebar for stats */
            .mobile-modal>.modal-body {
                display: flex;
                flex-direction: row;
                gap: 15px;
                /* Distinct gap */
                width: 100%;
                padding: 0;
            }

            .mobile-stats {
                flex-direction: column;
                width: 150px;
                /* WIDER sidebar to prevent overlap */
                justify-content: flex-start;
                gap: 5px;
                padding-top: 5px;
                border-right: 1px solid #444;
                font-size: 0.85rem;
                margin: 0;
                background: rgba(0, 0, 0, 0.2);
                /* Slight dim to separate */
                flex-shrink: 0;
                /* Prevent shrinking */
                padding-right: 5px;
            }

            /* Increased specificity to override .eq-grid */
            .mobile-modal .mobile-grid {
                flex-grow: 1;
                /* FIXED 44px columns */
                grid-template-columns: repeat(auto-fill, 44px);
                padding-right: 25px;
                gap: 4px;
                justify-content: start;
            }

            /* Absolute Close Button for Landscape */
            .modal-close-landscape {
                position: absolute;
                top: 10px;
                right: 10px;
                font-size: 22px;
                width: 40px;
                height: 40px;
                display: flex !important;
                align-items: center;
                justify-content: center;
                z-index: 2005;
                background: rgba(239, 68, 68, 0.8);
                /* Red tint */
                color: white;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
                cursor: pointer;
            }
        }

        /* Force override for .eq-grid inside mobile modal regardless of order */
        .mobile-modal .eq-grid {
            grid-template-columns: repeat(auto-fill, 44px) !important;
        }

        .modal-close-landscape {
            display: none;
        }

        /* Hidden by default */

        /* Game Map Area */
        .game-map-container {
            grid-column: 2;
            grid-row: 2;
            position: relative;
            background: linear-gradient(to bottom, #050505 0%, #1a1a1a 100%);
            overflow: hidden;
            border: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1200px;
            /* ENABLES 3D DEPTH */
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            touch-action: none;
        }

        /* The actual game world - ISOMETRIC VIEW */
        #worldGrid {
            position: absolute;
            width: 800px;
            height: 800px;
            background-color: #1a1a1a;
            /* Side View Tilted Perspective */
            transform: rotateX(60deg);
            transform-style: preserve-3d;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5) inset;
            border: 10px solid #111;
            left: 0;
            top: 0;

            /* NO CSS TRANSITION - JavaScript lerp handles smooth camera */
            will-change: transform;

            /* Grid floor texture - NOW HANDLED BY TILES */
            background-color: #1a3318;
            border: 10px solid #0f2210;
            box-shadow: 0 40px 80px rgba(0, 0, 0, 0.9);
            transform-style: preserve-3d;
        }

        .tile {
            position: absolute;
            width: 32px;
            height: 32px;
            background-color: #2d5a2d;
            border: 1px solid rgba(0, 0, 0, 0.25);
            box-sizing: border-box;
            background-image:
                linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                linear-gradient(225deg, rgba(0, 0, 0, 0.1) 0%, transparent 50%);
        }

        .tile:nth-child(odd) {
            background-color: #245024;
        }

        .entity {
            position: absolute;
            width: 32px;
            height: 32px;

            /* NO TRANSITION - instant snap, camera handles all smoothness */
            transition: none;

            transform-style: preserve-3d;
            transform: translate3d(0, 0, 10px) rotateX(-60deg) translate(0, -50%) scale(1.0);
            transform-origin: bottom center;

            /* REMOVED BACKGROUND/PADDING PER USER REQUEST */
            background: none;
            padding: 0;
            border: none;

            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            /* GPU acceleration for smooth movement */
            will-change: left, top, transform;
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.5));
        }

        .player-token {
            z-index: 100;
            width: 48px;
            height: 64px;
            /* Keep 2.5D transform from .entity */
            transform: translate3d(0, 0, 15px) rotateX(-60deg) translate(0, -60%) scale(1.2);
        }

        .player-token img {
            width: 100%;
            height: 100%;
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
            object-fit: cover;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            border: 2px solid rgba(255, 215, 0, 0.5);
        }

        .npc {
            /* Removed red bg */
            background: rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            font-size: 20px;
        }

        /* Monster Styles */
        .monster {
            width: 24px;
            height: 32px;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: auto;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            /* 2.5D perspective */
            transform-style: preserve-3d;
            transform: translate3d(0, 0, 10px) rotateX(-60deg) translate(0, -50%);
            transform-origin: bottom center;
            animation: monsterIdle 2s ease-in-out infinite;
        }

        @keyframes monsterIdle {

            0%,
            100% {
                transform: translate3d(0, 0, 10px) rotateX(-60deg) translate(0, -50%);
            }

            50% {
                transform: translate3d(0, -1px, 10px) rotateX(-60deg) translate(0, -50%);
            }
        }

        .monster-img {
            width: 24px;
            height: 24px;
            object-fit: contain;
            image-rendering: pixelated;
        }

        .monster-emoji {
            font-size: 16px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* === 2.5D ENVIRONMENT ELEMENTS === */
        .env-tree {
            position: absolute;
            transform-style: preserve-3d;
            transform: translate3d(0, 0, 5px) rotateX(-60deg);
            transform-origin: bottom center;
            pointer-events: none;
            z-index: 10;
        }

        .env-tree svg {
            filter: drop-shadow(2px 4px 3px rgba(0,0,0,0.4));
        }

        .env-rock {
            position: absolute;
            transform-style: preserve-3d;
            transform: translate3d(0, 0, 2px) rotateX(-60deg);
            transform-origin: bottom center;
            pointer-events: none;
            z-index: 5;
        }

        .env-flower-3d {
            position: absolute;
            transform-style: preserve-3d;
            transform: translate3d(0, 0, 3px) rotateX(-60deg);
            transform-origin: bottom center;
            pointer-events: none;
            z-index: 4;
        }

        /* Tile floor should be flat */
        .tile-svg-container {
            transform-style: flat;
        }

        /* Player house - standing upright on tilted ground */
        .player-house {
            transform-style: preserve-3d;
            transform: translate3d(0, 0, 5px) rotateX(-60deg) !important;
            transform-origin: bottom center !important;
        }

        .monster-name {
            font-size: 3px;
            color: #ffffff;
            background: rgba(0, 0, 0, 0.6);
            padding: 1px 2px;
            border-radius: 1px;
            text-shadow: none;
            white-space: nowrap;
            user-select: none;
            pointer-events: none;
        }

        .monster-hp-bar {
            display: none;
            /* Hidden on map */
        }

        .monster-hp-fill {
            height: 100%;
            background: linear-gradient(to right, #ff4444, #ff0000);
            border-radius: 2px;
            transition: width 0.2s ease;
        }

        /* Floating Damage */
        .floating-damage {
            position: absolute;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 0 3px black, 0 0 6px black;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            z-index: 1000;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            50% {
                opacity: 1;
                transform: translateY(-30px) scale(1.2);
            }

            100% {
                opacity: 0;
                transform: translateY(-60px) scale(0.8);
            }
        }

        /* IRATUS-STYLE COMBAT SCREEN */
        #combatScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 2000;
            /* iOS safe area */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            box-sizing: border-box;
        }

        #combatScreen.active {
            display: flex;
        }

        .combat-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('../img/locations/lodowa.png') center center;
            background-size: cover;
            opacity: 0.6;
            z-index: 0;
        }

        /* In-game message overlay (replaces alert) */
        .game-message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .game-message {
            background: linear-gradient(135deg, rgba(30, 30, 40, 0.95), rgba(20, 20, 30, 0.98));
            border: 2px solid var(--color-gold);
            border-radius: 15px;
            padding: 20px 30px;
            /* Reduced from 30px 50px */
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            position: relative;
            /* For X button */
            max-width: 90%;
        }

        .game-message.success {
            border-color: #4CAF50;
            box-shadow: 0 0 30px rgba(76, 175, 80, 0.4);
        }

        .game-message.error {
            border-color: #f44336;
            box-shadow: 0 0 30px rgba(244, 67, 54, 0.4);
        }

        .game-message-text {
            font-size: 1.4rem;
            /* Reduced from 1.8rem */
            color: #fff;
            font-family: 'Cinzel', serif;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .game-message-btn {
            background: linear-gradient(135deg, var(--color-gold), #ffd700);
            border: none;
            color: #000;
            padding: 12px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-message-btn:hover,
        .game-message-btn:active {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Force landscape globally on portrait mobile */
        @media screen and (orientation: portrait) and (max-width: 768px) {
            body {
                transform: rotate(90deg);
                transform-origin: left top;
                width: 100vh;
                height: 100vw;
                position: fixed;
                top: 0;
                left: 100%;
                overflow: hidden;
            }

            #joystickContainer {
                display: none;
                /* Hide in rotated view */
            }
        }

        /* Particle Effects */
        .particle {
            position: fixed;
            pointer-events: none;
            z-index: 99998;
            border-radius: 50%;
            animation: particleFade 0.6s ease-out forwards;
        }

        @keyframes particleFade {
            0% {
                opacity: 1;
                transform: scale(1) translate(0, 0);
            }

            100% {
                opacity: 0;
                transform: scale(0.3) translate(var(--tx), var(--ty));
            }
        }

        /* Animated Combat Background */
        .combat-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 0;
        }

        .combat-bg::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.02) 25%,
                    transparent 50%,
                    rgba(0, 0, 0, 0.05) 75%,
                    transparent 100%);
            animation: fogMove 20s linear infinite;
        }

        @keyframes fogMove {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        /* Turn Counter */
        .turn-counter {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 10;
        }

        /* XP Bar after combat */
        .xp-reward-bar {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 15px;
            z-index: 100000;
            text-align: center;
            animation: slideUp 0.5s ease-out;
        }

        .xp-reward-bar h3 {
            margin: 0 0 10px 0;
            color: #ffd700;
        }

        .xp-bar-container {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #a855f7);
            transition: width 1s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Item Button in Combat */
        .item-btn {
            border-bottom: 2px solid rgba(200, 160, 60, 0.8);
            box-shadow:
                0 1px 0 rgba(255, 255, 255, 0.05) inset,
                0 4px 12px rgba(0, 0, 0, 0.5),
                0 0 20px rgba(200, 160, 60, 0.15);
        }

        /* Cooldown overlay */
        .combat-btn.on-cooldown {
            opacity: 0.5;
            pointer-events: none;
        }

        .combat-btn .cooldown-text {
            position: absolute;
            font-size: 10px;
            color: #ff6666;
        }

        .combatant-mana-bar {
            width: 100%;
            height: 6px;
            background: #333;
            border: 1px solid #555;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .combatant-mana-fill {
            height: 100%;
            background: linear-gradient(90deg, #0055ff, #00ccff);
            width: 100%;
            transition: width 0.3s;
        }

        /* --- COMPACT & MOBILE COMBAT STYLES --- */
        .combat-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            padding: 10px;
            box-sizing: border-box;
        }

        .combat-main-area {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            padding: 0 5%;
        }

        .combat-side {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            /* Align to bottom so player & enemy are level */
            z-index: 2;
        }

        .combatant {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .combatant-info-row {
            display: flex;
            gap: 8px;
            align-items: baseline;
            text-shadow: 0 0 5px black;
        }

        .combatant-name {
            font-size: 14px;
            font-weight: bold;
            color: #fff;
        }

        .combatant-level {
            font-size: 11px;
            color: #ffd700;
        }

        .combatant-sprite {
            font-size: 100px;
            /* Scaling base for emojis */
            transition: transform 0.2s;
            margin: 5px 0;
        }

        .combatant-sprite img {
            width: 160px !important;
            height: 160px !important;
            object-fit: contain;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.5));
        }

        .combatant-sprite.attacking {
            animation: attackAnim 0.3s ease-out;
        }

        .combatant-sprite.hit {
            animation: hitAnim 0.3s ease-out;
        }

        .enemy-combatant .combatant-sprite.attacking {
            animation: attackAnimEnemy 0.3s ease-out;
        }

        @keyframes attackAnim {
            0% {
                transform: translateX(0);
            }

            50% {
                transform: translateX(30px);
            }

            100% {
                transform: translateX(0);
            }
        }

        @keyframes attackAnimEnemy {
            0% {
                transform: translateX(0);
            }

            50% {
                transform: translateX(-30px);
            }

            100% {
                transform: translateX(0);
            }
        }

        @keyframes hitAnim {
            0% {
                filter: brightness(1) drop-shadow(0 5px 15px rgba(0, 0, 0, 0.5));
            }

            50% {
                filter: brightness(3) hue-rotate(180deg) drop-shadow(0 0 20px red);
            }

            100% {
                filter: brightness(1) drop-shadow(0 5px 15px rgba(0, 0, 0, 0.5));
            }
        }

        /* Floating Damage Text */
        .floating-damage {
            position: fixed;
            font-size: 28px;
            font-weight: 900;
            pointer-events: none;
            z-index: 99999;
            animation: floatUp 1.2s ease-out forwards;
            text-shadow:
                0 0 15px currentColor,
                0 0 30px currentColor,
                2px 2px 4px rgba(0, 0, 0, 0.9);
            font-family: 'Arial Black', sans-serif;
        }

        .floating-damage.damage {
            color: #ff4444;
        }

        .floating-damage.heal {
            color: #44ff88;
        }

        .floating-damage.enemy-damage {
            color: #ffaa00;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            50% {
                opacity: 1;
                transform: translateY(-30px) scale(1.2);
            }

            100% {
                opacity: 0;
                transform: translateY(-60px) scale(0.8);
            }
        }

        /* Idle Breathing Animation - subtle */
        @keyframes idleBreathe {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-2px);
            }
        }

        .combatant-sprite {
            animation: idleBreathe 3s ease-in-out infinite;
        }

        .enemy-combatant .combatant-sprite {
            animation: idleBreathe 3.5s ease-in-out infinite;
            animation-delay: 0.8s;
        }

        .combatant-bars {
            width: 100px;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .combatant-hp-bar {
            width: 100%;
            height: 10px;
            background: #222;
            border: 1px solid #444;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .combatant-hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4d4d, #ff0000);
            width: 100%;
            transition: width 0.3s;
        }

        .enemy-hp {
            background: linear-gradient(90deg, #ff8800, #ff4400);
        }

        .combatant-stat-text {
            font-size: 9px;
            color: #fff;
            text-align: center;
            margin-top: -1px;
        }

        .mana-text {
            color: #aaf;
        }

        .combat-vs {
            font-size: 24px;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.2);
            font-family: 'Cinzel', serif;
        }

        /* ACTIONS & LOG */
        .combat-ui {
            height: 140px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            justify-content: flex-end;
            padding-bottom: 5px;
        }

        .combat-log {
            height: 40px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #444;
            padding: 4px;
            font-size: 11px;
            color: #ddd;
            text-align: center;
            border-radius: 4px;
            max-width: 300px;
            /* Matched to button row */
            margin: 0 auto;
            /* Center it */
            width: 100%;
        }

        .combat-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            z-index: 100;
            position: relative;
        }

        .combat-btn {
            background: linear-gradient(to bottom, #555, #333);
            border: 2px solid #888;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-family: 'Cinzel', serif;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px #111;
            transition: transform 0.1s, box-shadow 0.1s;
            min-width: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.1;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .combat-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 #111;
            background: linear-gradient(to bottom, #666, #444);
        }

        .btn-sub {
            font-size: 9px;
            color: #aaa;
            margin-top: 2px;
        }

        .combat-turn-indicator {
            text-align: center;
            font-size: 12px;
            color: #ffd700;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 2px;
        }

        /* --- POPUP MENU (Glassmorphism) --- */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            /* Hidden by default */
            justify-content: center;
            align-items: center;
        }

        .menu {
            background: rgba(20, 20, 20, 0.9);
            border: 2px solid #555;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            border-radius: 12px;
            padding: 24px;
            width: 80%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: relative;
        }

        /* Adjusted button styles for clean look */
        .menu-item {
            background: #333;
            border: 1px solid #555;
            color: white;
            padding: 12px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            transition: background 0.2s;
        }

        .menu-item:hover {
            background: #444;
            border-color: #777;
        }

        .close-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            font-size: 24px;
            color: #888;
            cursor: pointer;
            background: none;
            border: none;
        }

        .close-btn:hover {
            color: white;
        }

        #joystickBase {
            position: absolute;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            pointer-events: auto;
        }

        #joystickKnob {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        /* Chat Removed */

        /* Stats */
        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 5px;
            border-bottom: 1px solid #222;
            padding-bottom: 2px;
        }

        .stat-val {
            color: var(--color-gold);
            font-weight: bold;
        }

        .eq-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            margin-top: 10px;
        }

        .eq-slot {
            aspect-ratio: 1;
            background: #222;
            border: 1px solid #444;
        }

        /* --- ARENA SCREEN (HoMM Style) --- */
        #arenaScreen {
            display: none;
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            background: #050505;
            z-index: 1000;
        }

        #arenaScreen.active {
            display: flex;
        }

        .arena-layout {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .arena-sidebar {
            width: 250px;
            background: #111;
            border-right: 2px solid var(--color-border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .arena-main {
            flex: 1;
            position: relative;
            background: #050505;
            /* Removed image, dark bg */
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1200px;
        }

        /* Arena Grid - Smaller, focused */

        /* Arena Grid - Larger & More Tiles */
        #arenaGrid {
            position: relative;
            width: 768px;
            /* 12 * 64 */
            height: 640px;
            /* 10 * 64 */
            /* Side View Perspective */
            transform: rotateX(60deg) translateY(50px);
            transform-style: preserve-3d;
            background-color: rgba(0, 0, 0, 0.2);
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 64px 64px;
            /* Bigger tiles for battle */
            border: none;
            box-shadow: none;
        }

        .arena-tile {
            position: absolute;
            width: 64px;
            height: 64px;
            box-sizing: border-box;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.2s;
        }

        .arena-tile.move-range {
            background: rgba(0, 255, 0, 0.2);
            cursor: pointer;
            border: 1px solid lime;
        }

        .arena-tile.attack-range {
            background: rgba(255, 0, 0, 0.3);
            cursor: pointer;
            border: 1px solid red;
        }

        .arena-tile:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .arena-unit {
            position: absolute;
            width: 64px;
            height: 64px;
            display: flex;
            justify-content: center;
            align-items: center;
            transform-style: preserve-3d;
            /* Billboard logic - counteract grid rotateX(60deg) */
            /* Slimmer: scale(1.4, 1.8) -> narrower width */
            transform: translate3d(0, 0, 0) rotateX(-60deg) translate(0, -90%) scale(1.4, 1.8);
            pointer-events: none;
            transition: all 0.4s ease;
        }

        .arena-unit img {
            width: 80px;
            height: 80px;
            filter: drop-shadow(0 10px 5px black);
        }

        .arena-unit-hp {
            position: absolute;
            top: -20px;
            background: black;
            border: 1px solid #555;
            height: 6px;
            width: 40px;
        }

        .arena-unit-hp-fill {
            height: 100%;
            background: lime;
            width: 100%;
        }

        .enemy .arena-unit-hp-fill {
            background: red;
        }

        .action-btn {
            background: #222;
            color: var(--color-gold);
            border: 1px solid var(--color-border);
            padding: 10px;
            font-family: inherit;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.2s;
        }

        .action-btn:hover {
            background: #333;
            border-color: var(--color-gold);
        }

        /* VIRTUAL JOYSTICK */
        #joystickContainer {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 120px;
            height: 120px;
            z-index: 200;
            display: none;
            /* Hidden until game starts */
        }

        #joystickBase {
            position: absolute;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            pointer-events: auto;
        }

        #joystickKnob {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        /* Mobile Responsive Fixes */
        @media (max-width: 600px) {
            .top-bar {
                padding: 10px 5px;
                gap: 5px;
                flex-wrap: wrap;
                height: auto;
                font-size: 11px;
            }

            .player-info {
                width: 100%;
                order: 3;
                /* Move to bottom line if needed */
                margin-top: 5px;
            }

            /* Wizard Styles */
            .wizard-step {
                display: none;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
                animation: fadeIn 0.5s ease;
                width: 100%;
            }

            .wizard-step.active {
                display: flex;
            }

            /* PREMIUM CHARACTER CREATION PANEL */
            .step-1-row {
                display: flex;
                flex-direction: row;
                align-items: flex-end;
                justify-content: space-between;
                /* Name left, Gender right */
                gap: 40px;
                margin: 50px auto;
                padding: 40px 60px;
                background: linear-gradient(145deg, rgba(20, 20, 25, 0.85), rgba(10, 10, 15, 0.95));
                border-radius: 4px;
                border: 1px solid rgba(255, 215, 0, 0.15);
                box-shadow:
                    0 20px 50px rgba(0, 0, 0, 0.8),
                    inset 0 0 30px rgba(255, 215, 0, 0.05);
                backdrop-filter: blur(12px);
                position: relative;
                overflow: visible;
                width: 100%;
                max-width: 700px;
            }

            /* Decorative Corners */
            .step-1-row::before,
            .step-1-row::after {
                content: '';
                position: absolute;
                width: 20px;
                height: 20px;
                border: 2px solid var(--color-gold);
                opacity: 0.6;
            }

            .step-1-row::before {
                top: -2px;
                left: -2px;
                border-right: 0;
                border-bottom: 0;
            }

            .step-1-row::after {
                bottom: -2px;
                right: -2px;
                border-left: 0;
                border-top: 0;
            }

            .input-wrapper {
                position: relative;
                width: 300px;
                display: flex;
                flex-direction: column;
            }

            .input-label {
                font-family: 'Outfit', sans-serif;
                font-size: 0.85rem;
                /* Slightly larger */
                font-weight: 600;
                /* Bolder */
                text-transform: uppercase;
                letter-spacing: 2px;
                color: var(--color-gold);
                margin-bottom: 12px;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.9);
                /* Strong shadow to separate from background */
                text-align: left;
                display: block;
            }

            #playerNameInput {
                padding: 12px 10px;
                font-size: 1.8rem;
                font-family: inherit;
                background: rgba(0, 0, 0, 0.2);
                /* Added subtle background for better contrast */
                border: none;
                border-bottom: 2px solid rgba(255, 215, 0, 0.3);
                color: #fff;
                text-align: left;
                width: 100%;
                outline: none;
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                letter-spacing: 1px;
                text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            }

            #playerNameInput:focus {
                border-bottom-color: var(--color-gold);
                padding-left: 20px;
                background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), transparent);
                text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            }

            #playerNameInput::placeholder {
                color: rgba(255, 255, 255, 0.4);
                /* Increased placeholder visibility */
                font-size: 1.4rem;
            }

            .gender-selection-side {
                display: flex;
                gap: 15px;
                flex-direction: row;
                align-items: flex-end;
                /* Align with bottom of input */
                padding-bottom: 5px;
                /* Fine-tune alignment with input field */
            }

            .gender-btn {
                width: 50px;
                height: 50px;
                border: 1px solid rgba(255, 215, 0, 0.2);
                background: rgba(0, 0, 0, 0.4);
                border-radius: 50%;
                /* Circle buttons for cleaner look */
                cursor: pointer;
                font-size: 1.4rem;
                transition: 0.3s all cubic-bezier(0.4, 0, 0.2, 1);
                display: flex;
                align-items: center;
                justify-content: center;
                color: #888;
                position: relative;
            }

            /* Tooltip behavior for circles */
            .gender-btn::after {
                content: attr(data-label);
                position: absolute;
                bottom: -25px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 0.65rem;
                text-transform: uppercase;
                letter-spacing: 1px;
                white-space: nowrap;
                opacity: 0;
                transition: 0.3s;
                color: var(--color-gold);
                pointer-events: none;
            }

            .gender-btn:hover {
                border-color: var(--color-gold);
                background: rgba(255, 215, 0, 0.1);
                color: white;
                transform: translateY(-3px);
            }

            .gender-btn:hover::after {
                opacity: 1;
                bottom: -30px;
            }

            .gender-btn.active {
                border-color: var(--color-gold);
                background: rgba(255, 215, 0, 0.25);
                color: var(--color-gold);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
                transform: scale(1.1);
            }

            .gender-btn.active::after {
                opacity: 1;
                font-weight: bold;
                color: var(--color-gold);
            }

            .error-msg {
                color: #ff6b6b;
                margin-top: 15px;
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 1px;
                text-align: center;
                min-height: 20px;
            }

            .wizard-btn {
                padding: 15px 50px;
                font-size: 1rem;
                text-transform: uppercase;
                letter-spacing: 4px;
                border: 1px solid var(--color-gold);
                background: transparent;
                color: var(--color-gold);
                cursor: pointer;
                transition: 0.4s;
                margin-top: 30px;
                position: relative;
                overflow: hidden;
            }

            .wizard-btn:hover {
                background: var(--color-gold);
                color: black;
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
            }

            .back-btn {
                margin-top: 20px;
                background: none;
                border: none;
                color: #888;
                cursor: pointer;
                font-size: 1rem;
                transition: 0.3s;
            }

            .back-btn:hover {
                color: white;
            }

            .orb.disabled {
                opacity: 0.5;
                pointer-events: none;
                filter: grayscale(1);
            }

            .char-attribute {
                font-size: 0.8rem;
                color: #aaa;
                margin-top: 5px;
                font-style: italic;
            }
        }

        /* WIZARD STYLES - GLOBAL (outside media query) */
        .wizard-step {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            animation: fadeIn 0.5s ease;
            width: 100%;
        }

        .wizard-step.active {
            display: flex;
        }

        /* Step 2 needs scrolling for cards */
        #step-class {
            justify-content: flex-start;
            padding: 30px 20px;
            overflow-y: auto;
            height: auto;
            min-height: 100vh;
        }

        .step-1-row {
            display: flex !important;
            flex-direction: row !important;
            align-items: flex-end;
            justify-content: space-between;
            gap: 40px;
            margin: 50px auto;
            padding: 40px 60px;
            background: linear-gradient(145deg, rgba(20, 20, 25, 0.85), rgba(10, 10, 15, 0.95));
            border-radius: 4px;
            border: 1px solid rgba(255, 215, 0, 0.15);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8), inset 0 0 30px rgba(255, 215, 0, 0.05);
            backdrop-filter: blur(12px);
            position: relative;
            overflow: visible;
            width: 100%;
            max-width: 700px;
        }

        .step-1-row::before,
        .step-1-row::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid var(--color-gold);
            opacity: 0.6;
        }

        .step-1-row::before {
            top: -2px;
            left: -2px;
            border-right: 0;
            border-bottom: 0;
        }

        .step-1-row::after {
            bottom: -2px;
            right: -2px;
            border-left: 0;
            border-top: 0;
        }

        .input-wrapper {
            position: relative;
            width: 300px;
            display: flex;
            flex-direction: column;
        }

        .input-label {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--color-gold);
            margin-bottom: 12px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.9);
            text-align: left;
            display: block;
        }

        #playerNameInput {
            padding: 12px 10px;
            font-size: 1.8rem;
            font-family: inherit;
            background: rgba(0, 0, 0, 0.2);
            border: none;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            color: #fff;
            text-align: left;
            width: 100%;
            outline: none;
            transition: all 0.4s;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        #playerNameInput:focus {
            border-bottom-color: var(--color-gold);
            padding-left: 20px;
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), transparent);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }

        #playerNameInput::placeholder {
            color: rgba(255, 255, 255, 0.4);
            font-size: 1.4rem;
        }

        .gender-selection-side {
            display: flex !important;
            flex-direction: row !important;
            gap: 15px;
            align-items: center;
        }

        .gender-btn {
            width: 50px;
            height: 50px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4rem;
            transition: 0.3s all;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
        }

        .gender-btn:hover {
            border-color: var(--color-gold);
            background: rgba(255, 215, 0, 0.1);
            color: white;
            transform: translateY(-3px);
        }

        .gender-btn.active {
            border-color: var(--color-gold);
            background: rgba(255, 215, 0, 0.25);
            color: var(--color-gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            transform: scale(1.1);
        }

        .error-msg {
            color: #ff6b6b;
            margin-top: 15px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
            min-height: 20px;
        }

        .orb.disabled {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(1);
        }

        .back-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #aaa;
            cursor: pointer;
            font-size: 1rem;
            padding: 10px 25px;
            border-radius: 4px;
            transition: 0.3s;
            letter-spacing: 1px;
        }

        .back-btn:hover {
            color: white;
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.1);
        }

        .step2-buttons {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-top: 30px;
            padding-bottom: 50px;
        }

        .step2-buttons .orb-right {
            position: relative;
            bottom: auto;
            right: auto;
        }

        /* Back button at top left */
        .back-btn-top {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: var(--color-gold);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 10px 20px;
            border-radius: 4px;
            transition: 0.3s;
            letter-spacing: 1px;
            backdrop-filter: blur(5px);
        }

        .back-btn-top:hover {
            border-color: var(--color-gold);
            background: rgba(255, 215, 0, 0.15);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        /* GRAJ button fixed at bottom right */
        #step-class .orb-right {
            position: fixed;
            bottom: 30px;
            right: 30px;
        }

        /* Fullscreen hint button */
        .fullscreen-hint {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--color-gold);
            color: var(--color-gold);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            animation: pulseGlow 2s ease-in-out infinite;
        }

        .fullscreen-hint:hover {
            background: rgba(255, 215, 0, 0.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            transform: scale(1.05);
        }

        #step-name {
            overflow: hidden;
            padding-top: 50px;
        }

        .wizard-btn-panel {
            padding: 12px 35px !important;
            font-size: 0.9rem !important;
            margin-top: 0 !important;
            letter-spacing: 3px !important;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 180, 0, 0.05)) !important;
            border: 1px solid var(--color-gold) !important;
            color: var(--color-gold) !important;
            border-radius: 4px !important;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2), inset 0 0 10px rgba(255, 215, 0, 0.05) !important;
            transition: all 0.3s ease !important;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: pulseGlow 2s ease-in-out infinite;
        }

        .wizard-btn-panel:hover {
            background: linear-gradient(135deg, var(--color-gold), #ffcc00) !important;
            color: #1a1a1a !important;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6), 0 5px 20px rgba(0, 0, 0, 0.4) !important;
            transform: translateY(-2px);
            text-shadow: none;
        }

        @keyframes pulseGlow {

            0%,
            100% {
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.2), inset 0 0 10px rgba(255, 215, 0, 0.05);
            }

            50% {
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.4), inset 0 0 15px rgba(255, 215, 0, 0.1);
            }
        }

        .char-attribute {
            font-size: 0.8rem;
            color: #aaa;
            margin-top: 5px;
            font-style: italic;
        }

        /* Wizard Title Styling */
        #selectScreen h1 {
            font-size: 2.5rem;
            color: var(--color-gold);
            text-shadow:
                0 0 20px rgba(255, 215, 0, 0.5),
                0 4px 10px rgba(0, 0, 0, 0.9),
                0 0 40px rgba(255, 215, 0, 0.2);
            text-transform: uppercase;
            letter-spacing: 5px;
            margin-bottom: 30px;
            font-weight: 700;
            -webkit-text-stroke: 1px rgba(0, 0, 0, 0.7);
            paint-order: stroke fill;
        }

        @media (max-width: 768px) {

            /* Hide desktop panels on mobile */
            .panel {
                display: none !important;
            }

            /* Make map take full screen */
            .game-map-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100% !important;
                height: 100% !important;
                z-index: 1;
            }

            /* Adjust HUD for mobile */
            .top-bar {
                background: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(2px);
                padding: 5px 10px;
                height: 50px;
                z-index: 10;
                justify-content: space-between;
                width: 100%;
                position: fixed;
                top: 0;
                left: 0;
            }

            #mobileHud {
                display: flex !important;
            }

            /* Show mobile buttons, hide desktop specific ones */
            .mobile-hud-btns {
                display: flex !important;
            }

            .hud-menu-btn {
                display: none !important;
            }

            /* Joystick visible */
            #joystickContainer {
                display: block !important;
            }

            /* Adjust Chat/Logs position if needed */
            #chatContainer {
                bottom: 15px;
                left: 15px;
                width: 250px;
                font-size: 10px;
                opacity: 0.8;
                pointer-events: none;
                /* Let clicks pass through */
            }

            /* Ensure modals are full screen or well centered */
            .modal-content {
                width: 95%;
                height: 90%;
            }

            /* -- FIX iOS COMBAT SCREEN -- */
            #combatScreen {
                height: 100dvh !important;
                /* Force dynamic viewport height */
                padding-bottom: env(safe-area-inset-bottom) !important;
            }

            .combat-container {
                height: 100% !important;
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
                /* Align content to bottom */
            }

            .combat-ui {
                height: auto !important;
                padding-bottom: 20px !important;
                /* Extra bottom padding */
                margin-bottom: env(safe-area-inset-bottom);
                flex-shrink: 0;
            }

            /* Make combatants visible above UI */
            .combat-main {
                flex-grow: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                padding-bottom: 20px;
            }

        }

        /* -- FIX iOS COMBAT SCREEN (LANDSCAPE SPECIFIC) -- */
        /* Increased to 1000px width to cover ALL mobile phones in landscape */
        @media (orientation: landscape) and (max-width: 1000px) {
            body {
                position: fixed;
                width: 100%;
                height: 100%;
                overflow: hidden;
            }

            #combatScreen {
                height: 100% !important;
                position: fixed;
                top: 0;
                left: 0;
                overflow: hidden;
                zoom: 0.9;
            }

            .combat-container {
                padding-bottom: 60px !important;
                justify-content: center;
            }

            /* Scale combat visuals - BIGGER */
            .combat-main-area {
                transform: scale(1.1);
                /* Larger characters */
                transform-origin: center bottom;
                margin-bottom: 0;
                flex-grow: 1;
                display: flex;
                align-items: flex-end;
                justify-content: center;
                gap: 80px;
                /* Space between player and enemy */
                width: 70%;
                margin-left: 15%;
                /* Move left */
                margin-right: auto;
                padding-bottom: 90px !important;
            }

            /* Enhanced visuals for bars */
            .combatant-bars {
                margin-top: -25px !important;
                /* Even closer */
                position: relative;
                z-index: 5;
                transform: scale(1.0);
                background: rgba(0, 0, 0, 0.4);
                padding: 4px;
                border-radius: 6px;
                backdrop-filter: blur(2px);
            }

            .combatant-sprite {
                margin-bottom: -5px !important;
                /* Overlap slightly */
                filter: drop-shadow(0 10px 10px rgba(0, 0, 0, 0.4));
            }

            /* COMBAT LOG - LEFT COLUMN */
            .combat-log {
                display: flex !important;
                flex-direction: column;
                position: fixed !important;
                left: 10px;
                top: 50%;
                transform: translateY(-50%);
                width: 160px;
                /* Wider */
                max-height: 75%;
                /* Taller */
                min-height: 120px;
                padding: 12px;
                background: rgba(10, 10, 14, 0.6);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 14px;
                font-size: 12px !important;
                font-weight: 500;
                color: rgba(255, 255, 255, 0.95);
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
                overflow-y: auto;
                white-space: normal;
                text-align: left;
                z-index: 9998;
                pointer-events: auto;
            }

            /* MODERN GLASS UI - BOTTOM CENTER */
            .combat-ui {
                position: fixed !important;
                bottom: 12px !important;
                left: 50%;
                transform: translateX(-50%);
                width: auto;
                min-width: 280px;
                max-width: 400px;
                padding: 10px 20px !important;

                /* Glassmorphism */
                background: rgba(10, 10, 14, 0.5);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.3);

                border-radius: 20px;
                z-index: 9999;
                height: auto !important;
                margin-bottom: env(safe-area-inset-bottom);
                display: flex;
                flex-direction: row;
                justify-content: center;
                align-items: center;
            }

            .mp-hint {
                position: absolute;
                top: -18px;
                right: 10px;
                font-size: 9px;
                color: rgba(255, 255, 255, 0.4);
                letter-spacing: 0.5px;
                cursor: help;
            }

            /* Player position adjustment */
            .player-side {
                transform: translateX(-15px) translateY(10px);
                /* Lower and left */
            }

            .combat-actions {
                display: flex;
                justify-content: center;
                gap: 6px;
            }

            /* Modern Premium Button Base */
            .combat-btn {
                padding: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                font-size: 20px !important;
                /* Slightly smaller symbols */
                min-width: 52px !important;
                /* Narrower to fit all 8 buttons */
                height: 50px !important;
                border-radius: 12px;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                color: rgba(255, 255, 255, 0.95);
                user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;

                /* Dark glass base */
                background: linear-gradient(180deg, rgba(40, 40, 50, 0.9) 0%, rgba(20, 20, 28, 0.95) 100%);
                border: 1px solid rgba(80, 80, 90, 0.5);
                box-shadow:
                    0 1px 0 rgba(255, 255, 255, 0.05) inset,
                    0 -1px 0 rgba(0, 0, 0, 0.3) inset,
                    0 4px 12px rgba(0, 0, 0, 0.5);
            }

            .combat-btn .btn-sub {
                font-size: 7px !important;
                /* Smaller text */
                opacity: 0.7;
                letter-spacing: 0.2px;
                margin-top: -3px;
                pointer-events: none;
                /* Prevents text from being selection target */
            }

            /* Attack - subtle red glow */
            .attack-btn {
                border-bottom: 2px solid rgba(180, 60, 60, 0.8);
                box-shadow:
                    0 1px 0 rgba(255, 255, 255, 0.05) inset,
                    0 4px 12px rgba(0, 0, 0, 0.5),
                    0 0 20px rgba(180, 60, 60, 0.15);
            }

            /* Skill - subtle orange accent */
            .skill-btn {
                border-bottom: 2px solid rgba(200, 120, 40, 0.8);
                box-shadow:
                    0 1px 0 rgba(255, 255, 255, 0.05) inset,
                    0 4px 12px rgba(0, 0, 0, 0.5),
                    0 0 20px rgba(200, 120, 40, 0.15);
            }

            /* Heal - subtle green accent */
            .heal-btn {
                border-bottom: 2px solid rgba(60, 160, 80, 0.8);
                box-shadow:
                    0 1px 0 rgba(255, 255, 255, 0.05) inset,
                    0 4px 12px rgba(0, 0, 0, 0.5),
                    0 0 20px rgba(60, 160, 80, 0.15);
            }

            /* Power Attack - purple accent */
            .power-btn {
                border-bottom: 2px solid rgba(160, 80, 200, 0.8);
                box-shadow:
                    0 1px 0 rgba(255, 255, 255, 0.05) inset,
                    0 4px 12px rgba(0, 0, 0, 0.5),
                    0 0 20px rgba(160, 80, 200, 0.15);
            }

            /* Defend - cyan accent */
            .defend-btn {
                border-bottom: 2px solid rgba(80, 180, 180, 0.8);
                box-shadow:
                    0 1px 0 rgba(255, 255, 255, 0.05) inset,
                    0 4px 12px rgba(0, 0, 0, 0.5),
                    0 0 20px rgba(80, 180, 180, 0.15);
            }

            /* Flee - subtle blue accent */
            .flee-btn {
                border-bottom: 2px solid rgba(80, 120, 180, 0.8);
                box-shadow:
                    0 1px 0 rgba(255, 255, 255, 0.05) inset,
                    0 4px 12px rgba(0, 0, 0, 0.5),
                    0 0 20px rgba(80, 120, 180, 0.15);
            }

            /* Hide MP hint on small mobiles if it overlaps */
            .mp-hint {
                display: none;
            }

            .combat-btn:active {
                transform: scale(0.95) translateY(2px);
                background: linear-gradient(180deg, rgba(50, 50, 60, 0.95) 0%, rgba(30, 30, 40, 0.98) 100%);
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.6);
            }

            .combat-turn-indicator {
                display: none;
            }

            .combat-vs {
                display: block !important;
                position: absolute;
                left: 50%;
                top: 45%;
                transform: translate(-50%, -50%);
                font-size: 28px;
                font-weight: 900;
                letter-spacing: 4px;
                color: rgba(255, 255, 255, 0.15);
                text-shadow:
                    0 0 20px rgba(255, 255, 255, 0.1),
                    0 2px 4px rgba(0, 0, 0, 0.5);
                z-index: 1;
            }
        }
    